<!-- templates/student/evaluations.html -->
 <!-- templates/student/evaluations.html -->
{% extends 'student/base_student.html' %}
{% load static %}

{% block title %}Mes Évaluations - Online School{% endblock %}

{% block student_content %}
<!-- Hero section -->
<section class="hero-section">
    <div class="container">
        <h1>Mes évaluations</h1>
        <p>Consultez vos quiz, examens, et devoirs à rendre</p>
    </div>
</section>

<!-- Main content -->
<main class="container">
    <!-- Filtres -->
    <section class="filters-section mb-4">
        <div class="card">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="courseFilter">Cours</label>
                            <select class="form-control" id="courseFilter">
                                <option value="">Tous les cours</option>
                                <option value="1">Introduction à la programmation</option>
                                <option value="2">Bases de données</option>
                                <option value="3">Développement Web</option>
                                <option value="4">Algorithmes fondamentaux</option>
                                <option value="5">Introduction aux réseaux</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="typeFilter">Type</label>
                            <select class="form-control" id="typeFilter">
                                <option value="">Tous les types</option>
                                <option value="quiz">Quiz</option>
                                <option value="exam">Examen</option>
                                <option value="assignment">Devoir</option>
                                <option value="project">Projet</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="statusFilter">Statut</label>
                            <select class="form-control" id="statusFilter">
                                <option value="">Tous les statuts</option>
                                <option value="upcoming">À venir</option>
                                <option value="available">Disponibles</option>
                                <option value="submitted">Soumis</option>
                                <option value="graded">Notés</option>
                                <option value="expired">Expirés</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="searchFilter">Recherche</label>
                            <input type="text" class="form-control" id="searchFilter" placeholder="Titre ou mot-clé">
                        </div>
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-12 text-right">
                        <button id="resetFilters" class="btn btn-secondary mr-2">
                            <i class="fas fa-undo"></i> Réinitialiser
                        </button>
                        <button id="applyFilters" class="btn btn-primary">
                            <i class="fas fa-filter"></i> Appliquer
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Résumé des notes -->
    <section class="grades-summary mb-4">
        <div class="row">
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="grade-card">
                    <div class="grade-value">15.2/20</div>
                    <div class="grade-label">Moyenne générale</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="grade-card">
                    <div class="grade-value">18/20</div>
                    <div class="grade-label">Meilleure note</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="grade-card">
                    <div class="grade-value">12/20</div>
                    <div class="grade-label">Note la plus basse</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="grade-card">
                    <div class="grade-value">90%</div>
                    <div class="grade-label">Taux de complétion</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Évaluations à faire -->
    <section class="upcoming-evaluations mb-5">
        <h2>Évaluations à faire prochainement</h2>
        <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle"></i> Vous avez <strong>3 évaluations</strong> à rendre dans les prochains jours.
        </div>
        <div class="evaluation-list">
            <!-- Devoir à rendre -->
            <div class="evaluation-item">
                <div class="evaluation-icon assignment">
                    <i class="fas fa-tasks"></i>
                </div>
                <div class="evaluation-info">
                    <h4>TP - Structures de contrôle</h4>
                    <p><strong>Cours :</strong> Introduction à la programmation</p>
                    <p><i class="fas fa-calendar-alt"></i> À rendre avant le 25/03/2023 (23:59)</p>
                </div>
                <div class="evaluation-details">
                    <div class="detail">
                        <i class="fas fa-clock"></i>
                        <span>Durée estimée: 2h</span>
                    </div>
                    <div class="detail">
                        <i class="fas fa-percentage"></i>
                        <span>Pondération: 15%</span>
                    </div>
                </div>
                <div class="evaluation-status">
                    <div class="countdown text-danger">4 jours restants</div>
                    <a href="#" class="btn btn-primary">Commencer</a>
                </div>
            </div>

            <!-- Quiz programmé -->
            <div class="evaluation-item">
                <div class="evaluation-icon quiz">
                    <i class="fas fa-question-circle"></i>
                </div>
                <div class="evaluation-info">
                    <h4>Quiz sur SQL - Requêtes avancées</h4>
                    <p><strong>Cours :</strong> Bases de données</p>
                    <p><i class="fas fa-calendar-alt"></i> Prévu le 20/03/2023 (14:00-15:00)</p>
                </div>
                <div class="evaluation-details">
                    <div class="detail">
                        <i class="fas fa-clock"></i>
                        <span>Durée: 1h</span>
                    </div>
                    <div class="detail">
                        <i class="fas fa-percentage"></i>
                        <span>Pondération: 10%</span>
                    </div>
                </div>
                <div class="evaluation-status">
                    <div class="countdown text-warning">Dans 3 jours</div>
                    <span class="badge badge-secondary">Non disponible</span>
                </div>
            </div>

            <!-- Examen à venir -->
            <div class="evaluation-item">
                <div class="evaluation-icon exam">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div class="evaluation-info">
                    <h4>Examen de mi-semestre</h4>
                    <p><strong>Cours :</strong> Introduction à la programmation</p>
                    <p><i class="fas fa-calendar-alt"></i> Prévu le 15/04/2023 (09:00-11:00)</p>
                </div>
                <div class="evaluation-details">
                    <div class="detail">
                        <i class="fas fa-clock"></i>
                        <span>Durée: 2h</span>
                    </div>
                    <div class="detail">
                        <i class="fas fa-percentage"></i>
                        <span>Pondération: 30%</span>
                    </div>
                </div>
                <div class="evaluation-status">
                    <div class="countdown">Dans 29 jours</div>
                    <span class="badge badge-secondary">Non disponible</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Évaluations terminées et notées -->
    <section class="completed-evaluations mb-5">
        <h2>Évaluations terminées et notées</h2>
        <div class="evaluation-list">
            <!-- Quiz noté -->
            <div class="evaluation-item">
                <div class="evaluation-icon quiz">
                    <i class="fas fa-question-circle"></i>
                </div>
                <div class="evaluation-info">
                    <h4>Quiz - Variables et Types</h4>
                    <p><strong>Cours :</strong> Introduction à la programmation</p>
                    <p><i class="fas fa-calendar-check"></i> Terminé le 10/03/2023</p>
                </div>
                <div class="evaluation-details">
                    <div class="detail">
                        <i class="fas fa-clock"></i>
                        <span>Durée: 30min</span>
                    </div>
                    <div class="detail">
                        <i class="fas fa-percentage"></i>
                        <span>Pondération: 5%</span>
                    </div>
                </div>
                <div class="evaluation-status completed">
                    <div class="grade">18/20</div>
                    <a href="#" class="btn btn-outline-primary">Revoir</a>
                </div>
            </div>

            <!-- Devoir noté -->
            <div class="evaluation-item">
                <div class="evaluation-icon assignment">
                    <i class="fas fa-tasks"></i>
                </div>
                <div class="evaluation-info">
                    <h4>TP1 - Manipulation de structures de données</h4>
                    <p><strong>Cours :</strong> Algorithmes fondamentaux</p>
                    <p><i class="fas fa-calendar-check"></i> Terminé le 05/03/2023</p>
                </div>
                <div class="evaluation-details">
                    <div class="detail">
                        <i class="fas fa-clock"></i>
                        <span>Temps passé: 1h45</span>
                    </div>
                    <div class="detail">
                        <i class="fas fa-percentage"></i>
                        <span>Pondération: 15%</span>
                    </div>
                </div>
                <div class="evaluation-status completed">
                    <div class="grade">16/20</div>
                    <a href="#" class="btn btn-outline-primary">Revoir</a>
                </div>
            </div>

            <!-- Projet noté -->
            <div class="evaluation-item">
                <div class="evaluation-icon assignment">
                    <i class="fas fa-project-diagram"></i>
                </div>
                <div class="evaluation-info">
                    <h4>Projet - Topologie réseau et configuration</h4>
                    <p><strong>Cours :</strong> Introduction aux réseaux</p>
                    <p><i class="fas fa-calendar-check"></i> Terminé le 28/02/2023</p>
                </div>
                <div class="evaluation-details">
                    <div class="detail">
                        <i class="fas fa-clock"></i>
                        <span>Temps passé: 10h</span>
                    </div>
                    <div class="detail">
                        <i class="fas fa-percentage"></i>
                        <span>Pondération: 40%</span>
                    </div>
                </div>
                <div class="evaluation-status completed">
                    <div class="grade">15/20</div>
                    <a href="#" class="btn btn-outline-primary">Revoir</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Évaluations soumises en attente de notation -->
    <section class="pending-evaluations mb-5">
        <h2>Évaluations en attente de notation</h2>
        <div class="evaluation-list">
            <!-- Devoir soumis -->
            <div class="evaluation-item">
                <div class="evaluation-icon assignment">
                    <i class="fas fa-tasks"></i>
                </div>
                <div class="evaluation-info">
                    <h4>TP2 - Manipulation DOM avec JavaScript</h4>
                    <p><strong>Cours :</strong> Développement Web</p>
                    <p><i class="fas fa-calendar-check"></i> Soumis le 12/03/2023</p>
                </div>
                <div class="evaluation-details">
                    <div class="detail">
                        <i class="fas fa-clock"></i>
                        <span>Temps passé: 3h20</span>
                    </div>
                    <div class="detail">
                        <i class="fas fa-percentage"></i>
                        <span>Pondération: 20%</span>
                    </div>
                </div>
                <div class="evaluation-status">
                    <div class="pending-badge">
                        <span class="badge badge-warning">En attente de correction</span>
                    </div>
                    <a href="#" class="btn btn-outline-primary">Voir</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Calendrier des évaluations -->
    <section class="evaluation-calendar mb-5">
        <h2>Calendrier des évaluations</h2>
        <div class="card">
            <div class="card-body">
                <div id="evaluationCalendar"></div>
            </div>
        </div>
    </section>
</main>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Gestion des filtres
        const resetFiltersBtn = document.getElementById('resetFilters');
        const applyFiltersBtn = document.getElementById('applyFilters');
        
        if (resetFiltersBtn) {
            resetFiltersBtn.addEventListener('click', function() {
                document.getElementById('courseFilter').value = '';
                document.getElementById('typeFilter').value = '';
                document.getElementById('statusFilter').value = '';
                document.getElementById('searchFilter').value = '';
            });
        }
        
        if (applyFiltersBtn) {
            applyFiltersBtn.addEventListener('click', function() {
                // Récupérer les valeurs des filtres
                const course = document.getElementById('courseFilter').value;
                const type = document.getElementById('typeFilter').value;
                const status = document.getElementById('statusFilter').value;
                const search = document.getElementById('searchFilter').value;
                
                // Construire la requête (simulation pour l'exemple)
                const query = {
                    course: course,
                    type: type,
                    status: status,
                    search: search
                };
                
                console.log('Applying filters:', query);
                
                // Simuler un chargement
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Chargement...';
                
                // Réinitialiser après un court délai (à remplacer par un appel API réel)
                setTimeout(() => {
                    this.innerHTML = '<i class="fas fa-filter"></i> Appliquer';
                    
                    // Simuler une notification de filtrage réussi
                    showNotification('Filtres appliqués avec succès !', 'success');
                }, 800);
            });
        }
        
        // Animation des éléments d'évaluation
        const evaluationItems = document.querySelectorAll('.evaluation-item');
        
        evaluationItems.forEach(item => {
            item.addEventListener('mouseenter', function() {
                this.style.backgroundColor = '#f8f9fa';
                this.style.transform = 'translateX(5px)';
            });
            
            item.addEventListener('mouseleave', function() {
                this.style.backgroundColor = '#fff';
                this.style.transform = 'translateX(0)';
            });
        });
        
        // Initialisation du calendrier
        const calendarEl = document.getElementById('evaluationCalendar');
        
        if (calendarEl && typeof FullCalendar !== 'undefined') {
            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,listMonth'
                },
                locale: 'fr',
                firstDay: 1, // Lundi comme premier jour
                height: 'auto',
                events: [
                    // Données simulées pour l'exemple
                    {
                        title: 'TP - Structures de contrôle',
                        start: '2023-03-25T23:59:00',
                        color: '#f6c23e'
                    },
                    {
                        title: 'Quiz SQL - Requêtes avancées',
                        start: '2023-03-20T14:00:00',
                        end: '2023-03-20T15:00:00',
                        color: '#4e73df'
                    },
                    {
                        title: 'Examen de mi-semestre',
                        start: '2023-04-15T09:00:00',
                        end: '2023-04-15T11:00:00',
                        color: '#e74a3b'
                    },
                    {
                        title: 'Quiz - Variables et Types',
                        start: '2023-03-10T14:00:00',
                        end: '2023-03-10T14:30:00',
                        color: '#858796'
                    },
                    {
                        title: 'TP2 - Manipulation DOM',
                        start: '2023-03-12T23:59:00',
                        color: '#858796'
                    },
                ],
                eventClick: function(info) {
                    alert('Évaluation: ' + info.event.title);
                }
            });
            
            calendar.render();
        }
        
        // Fonction pour afficher des notifications
        function showNotification(message, type = 'info') {
            // Créer l'élément de notification
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-icon">
                    <i class="fas ${type === 'info' ? 'fa-info-circle' : 
                                   type === 'success' ? 'fa-check-circle' : 
                                   type === 'warning' ? 'fa-exclamation-triangle' : 
                                   'fa-times-circle'}"></i>
                </div>
                <div class="notification-content">
                    <p>${message}</p>
                </div>
                <button class="close">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            // Créer ou récupérer le conteneur de notifications
            let notificationsContainer = document.querySelector('.notifications-container');
            
            if (!notificationsContainer) {
                notificationsContainer = document.createElement('div');
                notificationsContainer.className = 'notifications-container';
                document.body.appendChild(notificationsContainer);
            }
            
            // Ajouter la notification
            notificationsContainer.appendChild(notification);
            
            // Gestion du bouton de fermeture
            notification.querySelector('.close').addEventListener('click', function() {
                notification.classList.add('fade-out');
                setTimeout(() => {
                    notification.remove();
                    
                    // Nettoyer le conteneur s'il est vide
                    if (notificationsContainer.children.length === 0) {
                        notificationsContainer.remove();
                    }
                }, 300);
            });
            
            // Fermeture automatique après 3 secondes
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    notification.classList.add('fade-out');
                    setTimeout(() => {
                        notification.remove();
                        
                        // Nettoyer le conteneur s'il est vide
                        if (notificationsContainer.children.length === 0) {
                            notificationsContainer.remove();
                        }
                    }, 300);
                }
            }, 3000);
        }
    });
</script>
{% endblock %}